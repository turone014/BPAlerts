# -*- coding: utf-8 -*-
"""alerts

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1C26Z_tIEpyN2CnpJu-XngkkTVkL08U_D

1 HR BP LONG
"""

import ccxt
import pandas as pd
import requests
from ta.momentum import RSIIndicator
from ta.trend import MACD
from datetime import datetime
from zoneinfo import ZoneInfo  # Python 3.9+

# ====== CONFIGURATION ======
DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1360281611035218172/5lpdPZYq81fCotoK3CMMiJPvF2uyQqYGvdMMuoXS0EAiF1DFp-l_IGJGwRgc-yDcbonp'  # replace this
OPTIONAL_PAIRS = ['BTC-USDT-SWAP', 'ETH-USDT-SWAP', 'SOL-USDT-SWAP', 'XRP-USDT-SWAP', 'DOGE-USDT-SWAP', 'SUI-USDT-SWAP', 'BNB-USDT-SWAP', 'ADA-USDT-SWAP', 'AVAX-USDT-SWAP', 'OM-USDT-SWAP', 'LTC-USDT-SWAP', 'PEPE-USDT-SWAP', 'TRUMP-USDT-SWAP', 'ALCH-USDT-SWAP', 'BCH-USDT-SWAP', 'LINK-USDT-SWAP', 'TON-USDT-SWAP', 'TRX-USDT-SWAP', 'FARTCOIN-USDT-SWAP', 'AAVE-USDT-SWAP', 'CRV-USDT-SWAP', 'FIL-USDT-SWAP', 'DOT-USDT-SWAP', 'APT-USDT-SWAP', 'ONDO-USDT-SWAP', 'EOS-USDT-SWAP', 'SHIB-USDT-SWAP', 'LAYER-USDT-SWAP', 'ETC-USDT-SWAP', 'ORDI-USDT-SWAP', 'IP-USDT-SWAP', 'UNI-USDT-SWAP', 'PROMPT-USDT-SWAP', 'PNUT-USDT-SWAP', 'WLD-USDT-SWAP', 'OP-USDT-SWAP', 'NEAR-USDT-SWAP', 'HBAR-USDT-SWAP', 'MOVE-USDT-SWAP', 'PI-USDT-SWAP', 'XLM-USDT-SWAP', 'WIF-USDT-SWAP', 'HYPE-USDT-SWAP', 'LDO-USDT-SWAP', 'BABY-USDT-SWAP', 'VINE-USDT-SWAP', 'ZKJ-USDT-SWAP', 'AUCTION-USDT-SWAP', 'TIA-USDT-SWAP', 'SATS-USDT-SWAP', 'ATOM-USDT-SWAP', 'UXLINK-USDT-SWAP', 'ARB-USDT-SWAP', 'BERA-USDT-SWAP', 'PEOPLE-USDT-SWAP', 'BIGTIME-USDT-SWAP', 'KAITO-USDT-SWAP', 'CORE-USDT-SWAP', 'MKR-USDT-SWAP','ZRO-USDT-SWAP','GAS-USDT-SWAP','POPCAT-USDT-SWAP','CFX-USDT-SWAP','JUP-USDT-SWAP','AI16Z-USDT-SWAP','PARTI-USDT-SWAP','POL-USDT-SWAP','ACT-USDT-SWAP','S-USDT-SWAP','X-USDT-SWAP','DYDX-USDT-SWAP','TRB-USDT-SWAP','RENDER-USDT-SWAP','BONK-USDT-SWAP','XTZ-USDT-SWAP','NEO-USDT-SWAP','AIXBT-USDT-SWAP','MASK-USDT-SWAP','INJ-USDT-SWAP','STX-USDT-SWAP','ALGO-USDT-SWAP','GUN-USDT-SWAP','CRO-USDT-SWAP','LUNC-USDT-SWAP','ATH-USDT-SWAP','LPT-USDT-SWAP','MEW-USDT-SWAP','GALA-USDT-SWAP','ETHFI-USDT-SWAP','SONIC-USDT-SWAP','AXS-USDT-SWAP','TAO-USDT-SWAP','PENGU-USDT-SWAP','GRASS-USDT-SWAP','SAND-USDT-SWAP','API3-USDT-SWAP','ICP-USDT-SWAP','ENS-USDT-SWAP','JTO-USDT-SWAP','COMP-USDT-SWAP','NOT-USDT-SWAP','FLOKI-USDT-SWAP','NEIROETH-USDT-SWAP','W-USDT-SWAP','ACH-USDT-SWAP','BLUR-USDT-SWAP','IMX-USDT-SWAP','SHELL-USDT-SWAP','MANA-USDT-SWAP','STRK-USDT-SWAP','PYTH-USDT-SWAP','AR-USDT-SWAP','VIRTUAL-USDT-SWAP','NEIRO-USDT-SWAP','SUSHI-USDT-SWAP','RSR-USDT-SWAP','JELLYJELLY-USDT-SWAP','APE-USDT-SWAP','DOGS-USDT-SWAP','ZEREBRO-USDT-SWAP','OL-USDT-SWAP','YGG-USDT-SWAP','MOODENG-USDT-SWAP','CHZ-USDT-SWAP','RAY-USDT-SWAP','BSV-USDT-SWAP','EIGEN-USDT-SWAP','LOOKS-USDT-SWAP','GOAT-USDT-SWAP','YFI-USDT-SWAP','CATI-USDT-SWAP','XAUT-USDT-SWAP','ARC-USDT-SWAP','BOME-USDT-SWAP','AGLD-USDT-SWAP','ME-USDT-SWAP','ZETA-USDT-SWAP','TURBO-USDT-SWAP','ANIME-USDT-SWAP','J-USDT-SWAP','SSV-USDT-SWAP','ZRX-USDT-SWAP','HMSTR-USDT-SWAP','MERL-USDT-SWAP','SWARMS-USDT-SWAP','VANA-USDT-SWAP','MEMEFI-USDT-SWAP','MORPHO-USDT-SWAP','MEME-USDT-SWAP','DUCK-USDT-SWAP','GRT-USDT-SWAP','AEVO-USDT-SWAP','BR-USDT-SWAP','QTUM-USDT-SWAP','THETA-USDT-SWAP','GMT-USDT-SWAP','SNX-USDT-SWAP','STORJ-USDT-SWAP','FLOW-USDT-SWAP','ARKM-USDT-SWAP','GMX-USDT-SWAP','XCH-USDT-SWAP','CETUS-USDT-SWAP','NC-USDT-SWAP','USTC-USDT-SWAP','CVC-USDT-SWAP','ETHW-USDT-SWAP','VELO-USDT-SWAP','IOTA-USDT-SWAP','GRIFFAIN-USDT-SWAP','UMA-USDT-SWAP','ONT-USDT-SWAP','EGLD-USDT-SWAP','IOST-USDT-SWAP','GPS-USDT-SWAP','MAGIC-USDT-SWAP','METIS-USDT-SWAP','1INCH-USDT-SWAP','CVX-USDT-SWAP','GLM-USDT-SWAP','ULTI-USDT-SWAP','BADGER-USDT-SWAP','CAT-USDT-SWAP','CTC-USDT-SWAP','AIDOGE-USDT-SWAP','DGB-USDT-SWAP','ZIL-USDT-SWAP','BUZZ-USDT-SWAP','CELO-USDT-SWAP','BIO-USDT-SWAP','BAT-USDT-SWAP','MAJOR-USDT-SWAP','DEGEN-USDT-SWAP','ID-USDT-SWAP','JST-USDT-SWAP','KSM-USDT-SWAP','WOO-USDT-SWAP','MINA-USDT-SWAP','KNC-USDT-SWAP','LRC-USDT-SWAP','CSPR-USDT-SWAP','RDNT-USDT-SWAP','TNSR-USDT-SWAP','BAL-USDT-SWAP','RON-USDT-SWAP','PRCL-USDT-SWAP','SWEAT-USDT-SWAP','VRA-USDT-SWAP','LQTY-USDT-SWAP','PERP-USDT-SWAP','RVN-USDT-SWAP','PIPPIN-USDT-SWAP','ONE-USDT-SWAP','ORBS-USDT-SWAP','MOVR-USDT-SWAP','SWELL-USDT-SWAP','SCR-USDT-SWAP','FOXY-USDT-SWAP','T-USDT-SWAP','COOKIE-USDT-SWAP','FXS-USDT-SWAP','BICO-USDT-SWAP','AVAAI-USDT-SWAP','FLM-USDT-SWAP','SLP-USDT-SWAP','BAND-USDT-SWAP','NMR-USDT-SWAP','ACE-USDT-SWAP','JOE-USDT-SWAP','BRETT-USDT-SWAP','PUFFER-USDT-SWAP','NFT-USDT-SWAP','DOG-USDT-SWAP','BNT-USDT-SWAP','ZENT-USDT-SWAP','SLERF-USDT-SWAP','ICX-USDT-SWAP','ALPHA-USDT-SWAP','SUNDOG-USDT-SWAP','GODS-USDT-SWAP','WAXP-USDT-SWAP','LSK-USDT-SWAP','SOLV-USDT-SWAP','LUNA-USDT-SWAP','ZK-USDT-SWAP','ENJ-USDT-SWAP',
]  # Add more OKX USDT Futures pairs

RSI_PERIOD = 30
MACD_FAST = 12
MACD_SLOW = 26
MACD_SIGNAL = 9

RSI_OVERSOLD_LOW = 30
RSI_OVERSOLD_HIGH = 38

TIMEFRAME_RSI = '15m'
TIMEFRAME_DIVERGENCE = '5m'
CANDLE_LIMIT = 150

exchange = ccxt.okx()


# ====== HELPER FUNCTIONS ======

def fetch_candles(symbol, timeframe, limit):
    try:
        ohlcv = exchange.fetch_ohlcv(symbol, timeframe=timeframe, limit=limit)
        df = pd.DataFrame(ohlcv, columns=['timestamp', 'open', 'high', 'low', 'close', 'volume'])
        df['timestamp'] = pd.to_datetime(df['timestamp'], unit='ms')
        df.set_index('timestamp', inplace=True)
        return df
    except Exception as e:
        print(f"[ERROR] {symbol} {timeframe} fetch failed: {e}")
        return None


def add_indicators(df):
    df['rsi'] = RSIIndicator(close=df['close'], window=RSI_PERIOD).rsi()
    macd = MACD(close=df['close'], window_fast=MACD_FAST, window_slow=MACD_SLOW, window_sign=MACD_SIGNAL)
    df['macd_line'] = macd.macd()
    return df


def is_rsi_oversold(value):
    return RSI_OVERSOLD_LOW <= value <= RSI_OVERSOLD_HIGH


def detect_bullish_convergence(df):
    lows = df['low']
    rsi = df['rsi']
    macd_line = df['macd_line']

    local_lows = lows[(lows.shift(1) > lows) & (lows.shift(-1) > lows)]
    if len(local_lows) < 2:
        return False

    last_two = local_lows.sort_index(ascending=False).head(2).sort_index()
    idx1, idx2 = last_two.index

    p1, p2 = lows[idx1], lows[idx2]
    rsi1, rsi2 = rsi[idx1], rsi[idx2]
    macd1, macd2 = macd_line[idx1], macd_line[idx2]

    return (p2 < p1) and (rsi2 > rsi1) and (macd2 > macd1)


def send_discord_alert(symbol):
    now = datetime.now(ZoneInfo("Asia/Manila")).strftime('%Y-%m-%d %H:%M %Z')
    message = f"""üöÄ **Right Hand Alert**

**Symbol**: `{symbol}`
**Time**: {now}

**Conditions Met**:
- 15m RSI(30) between 30‚Äì38 ‚úÖ
- 5m Price: Lower Low üîª
- 5m RSI(30): Higher High ‚¨ÜÔ∏è
- 5m MACD Line: Higher High ‚¨ÜÔ∏è
===============================
"""
    payload = {"content": message}
    response = requests.post(DISCORD_WEBHOOK_URL, json=payload)
    if response.status_code == 204:
        print(f"[ALERT SENT] {symbol} at {now}")
    else:
        print(f"[ERROR] Failed to send alert for {symbol}: {response.status_code}")


# ====== MAIN CHECK ======

def check_symbol(symbol):
    # 15m timeframe check
    df_15m = fetch_candles(symbol, TIMEFRAME_RSI, CANDLE_LIMIT)
    if df_15m is None:
        return
    df_15m = add_indicators(df_15m)
    latest_rsi = df_15m['rsi'].dropna().iloc[-1]

    if not is_rsi_oversold(latest_rsi):
        print(f"[{symbol}] 15m RSI not oversold: {latest_rsi:.2f}")
        return

    # 5m timeframe convergence check
    df_5m = fetch_candles(symbol, TIMEFRAME_DIVERGENCE, CANDLE_LIMIT)
    if df_5m is None:
        return
    df_5m = add_indicators(df_5m)

    if detect_bullish_convergence(df_5m):
        send_discord_alert(symbol)
    else:
        print(f"[{symbol}] No Right Hand on 5m.")


def main():
    for symbol in OPTIONAL_PAIRS:
        check_symbol(symbol)


if __name__ == "__main__":
    main()

"""1HR BP SHORT"""

import ccxt
import pandas as pd
import requests
from ta.momentum import RSIIndicator
from ta.trend import MACD
from datetime import datetime
from zoneinfo import ZoneInfo  # Python 3.9+

# ====== CONFIGURATION ======
DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1360564112651980833/4B5bHYrxKWBAEQboj-QnT3z2OXflLBTHznRKOqCcn398IDLD3L_SL2yRbrox_KCj-klf'  # replace this
OPTIONAL_PAIRS = ['BTC-USDT-SWAP', 'ETH-USDT-SWAP', 'SOL-USDT-SWAP', 'XRP-USDT-SWAP', 'DOGE-USDT-SWAP', 'SUI-USDT-SWAP', 'BNB-USDT-SWAP', 'ADA-USDT-SWAP', 'AVAX-USDT-SWAP', 'OM-USDT-SWAP', 'LTC-USDT-SWAP', 'PEPE-USDT-SWAP', 'TRUMP-USDT-SWAP', 'ALCH-USDT-SWAP', 'BCH-USDT-SWAP', 'LINK-USDT-SWAP', 'TON-USDT-SWAP', 'TRX-USDT-SWAP', 'FARTCOIN-USDT-SWAP', 'AAVE-USDT-SWAP', 'CRV-USDT-SWAP', 'FIL-USDT-SWAP', 'DOT-USDT-SWAP', 'APT-USDT-SWAP', 'ONDO-USDT-SWAP', 'EOS-USDT-SWAP', 'SHIB-USDT-SWAP', 'LAYER-USDT-SWAP', 'ETC-USDT-SWAP', 'ORDI-USDT-SWAP', 'IP-USDT-SWAP', 'UNI-USDT-SWAP', 'PROMPT-USDT-SWAP', 'PNUT-USDT-SWAP', 'WLD-USDT-SWAP', 'OP-USDT-SWAP', 'NEAR-USDT-SWAP', 'HBAR-USDT-SWAP', 'MOVE-USDT-SWAP', 'PI-USDT-SWAP', 'XLM-USDT-SWAP', 'WIF-USDT-SWAP', 'HYPE-USDT-SWAP', 'LDO-USDT-SWAP', 'BABY-USDT-SWAP', 'VINE-USDT-SWAP', 'ZKJ-USDT-SWAP', 'AUCTION-USDT-SWAP', 'TIA-USDT-SWAP', 'SATS-USDT-SWAP', 'ATOM-USDT-SWAP', 'UXLINK-USDT-SWAP', 'ARB-USDT-SWAP', 'BERA-USDT-SWAP', 'PEOPLE-USDT-SWAP', 'BIGTIME-USDT-SWAP', 'KAITO-USDT-SWAP', 'CORE-USDT-SWAP', 'MKR-USDT-SWAP','ZRO-USDT-SWAP','GAS-USDT-SWAP','POPCAT-USDT-SWAP','CFX-USDT-SWAP','JUP-USDT-SWAP','AI16Z-USDT-SWAP','PARTI-USDT-SWAP','POL-USDT-SWAP','ACT-USDT-SWAP','S-USDT-SWAP','X-USDT-SWAP','DYDX-USDT-SWAP','TRB-USDT-SWAP','RENDER-USDT-SWAP','BONK-USDT-SWAP','XTZ-USDT-SWAP','NEO-USDT-SWAP','AIXBT-USDT-SWAP','MASK-USDT-SWAP','INJ-USDT-SWAP','STX-USDT-SWAP','ALGO-USDT-SWAP','GUN-USDT-SWAP','CRO-USDT-SWAP','LUNC-USDT-SWAP','ATH-USDT-SWAP','LPT-USDT-SWAP','MEW-USDT-SWAP','GALA-USDT-SWAP','ETHFI-USDT-SWAP','SONIC-USDT-SWAP','AXS-USDT-SWAP','TAO-USDT-SWAP','PENGU-USDT-SWAP','GRASS-USDT-SWAP','SAND-USDT-SWAP','API3-USDT-SWAP','ICP-USDT-SWAP','ENS-USDT-SWAP','JTO-USDT-SWAP','COMP-USDT-SWAP','NOT-USDT-SWAP','FLOKI-USDT-SWAP','NEIROETH-USDT-SWAP','W-USDT-SWAP','ACH-USDT-SWAP','BLUR-USDT-SWAP','IMX-USDT-SWAP','SHELL-USDT-SWAP','MANA-USDT-SWAP','STRK-USDT-SWAP','PYTH-USDT-SWAP','AR-USDT-SWAP','VIRTUAL-USDT-SWAP','NEIRO-USDT-SWAP','SUSHI-USDT-SWAP','RSR-USDT-SWAP','JELLYJELLY-USDT-SWAP','APE-USDT-SWAP','DOGS-USDT-SWAP','ZEREBRO-USDT-SWAP','OL-USDT-SWAP','YGG-USDT-SWAP','MOODENG-USDT-SWAP','CHZ-USDT-SWAP','RAY-USDT-SWAP','BSV-USDT-SWAP','EIGEN-USDT-SWAP','LOOKS-USDT-SWAP','GOAT-USDT-SWAP','YFI-USDT-SWAP','CATI-USDT-SWAP','XAUT-USDT-SWAP','ARC-USDT-SWAP','BOME-USDT-SWAP','AGLD-USDT-SWAP','ME-USDT-SWAP','ZETA-USDT-SWAP','TURBO-USDT-SWAP','ANIME-USDT-SWAP','J-USDT-SWAP','SSV-USDT-SWAP','ZRX-USDT-SWAP','HMSTR-USDT-SWAP','MERL-USDT-SWAP','SWARMS-USDT-SWAP','VANA-USDT-SWAP','MEMEFI-USDT-SWAP','MORPHO-USDT-SWAP','MEME-USDT-SWAP','DUCK-USDT-SWAP','GRT-USDT-SWAP','AEVO-USDT-SWAP','BR-USDT-SWAP','QTUM-USDT-SWAP','THETA-USDT-SWAP','GMT-USDT-SWAP','SNX-USDT-SWAP','STORJ-USDT-SWAP','FLOW-USDT-SWAP','ARKM-USDT-SWAP','GMX-USDT-SWAP','XCH-USDT-SWAP','CETUS-USDT-SWAP','NC-USDT-SWAP','USTC-USDT-SWAP','CVC-USDT-SWAP','ETHW-USDT-SWAP','VELO-USDT-SWAP','IOTA-USDT-SWAP','GRIFFAIN-USDT-SWAP','UMA-USDT-SWAP','ONT-USDT-SWAP','EGLD-USDT-SWAP','IOST-USDT-SWAP','GPS-USDT-SWAP','MAGIC-USDT-SWAP','METIS-USDT-SWAP','1INCH-USDT-SWAP','CVX-USDT-SWAP','GLM-USDT-SWAP','ULTI-USDT-SWAP','BADGER-USDT-SWAP','CAT-USDT-SWAP','CTC-USDT-SWAP','AIDOGE-USDT-SWAP','DGB-USDT-SWAP','ZIL-USDT-SWAP','BUZZ-USDT-SWAP','CELO-USDT-SWAP','BIO-USDT-SWAP','BAT-USDT-SWAP','MAJOR-USDT-SWAP','DEGEN-USDT-SWAP','ID-USDT-SWAP','JST-USDT-SWAP','KSM-USDT-SWAP','WOO-USDT-SWAP','MINA-USDT-SWAP','KNC-USDT-SWAP','LRC-USDT-SWAP','CSPR-USDT-SWAP','RDNT-USDT-SWAP','TNSR-USDT-SWAP','BAL-USDT-SWAP','RON-USDT-SWAP','PRCL-USDT-SWAP','SWEAT-USDT-SWAP','VRA-USDT-SWAP','LQTY-USDT-SWAP','PERP-USDT-SWAP','RVN-USDT-SWAP','PIPPIN-USDT-SWAP','ONE-USDT-SWAP','ORBS-USDT-SWAP','MOVR-USDT-SWAP','SWELL-USDT-SWAP','SCR-USDT-SWAP','FOXY-USDT-SWAP','T-USDT-SWAP','COOKIE-USDT-SWAP','FXS-USDT-SWAP','BICO-USDT-SWAP','AVAAI-USDT-SWAP','FLM-USDT-SWAP','SLP-USDT-SWAP','BAND-USDT-SWAP','NMR-USDT-SWAP','ACE-USDT-SWAP','JOE-USDT-SWAP','BRETT-USDT-SWAP','PUFFER-USDT-SWAP','NFT-USDT-SWAP','DOG-USDT-SWAP','BNT-USDT-SWAP','ZENT-USDT-SWAP','SLERF-USDT-SWAP','ICX-USDT-SWAP','ALPHA-USDT-SWAP','SUNDOG-USDT-SWAP','GODS-USDT-SWAP','WAXP-USDT-SWAP','LSK-USDT-SWAP','SOLV-USDT-SWAP','LUNA-USDT-SWAP','ZK-USDT-SWAP','ENJ-USDT-SWAP',
]  # Add more OKX USDT Futures pairs

RSI_PERIOD = 30
MACD_FAST = 12
MACD_SLOW = 26
MACD_SIGNAL = 9

RSI_OVERBOUGHT_LOW = 60
RSI_OVERBOUGHT_HIGH = 70

TIMEFRAME_RSI = '15m'
TIMEFRAME_DIVERGENCE = '5m'
CANDLE_LIMIT = 150

exchange = ccxt.okx()


# ====== HELPER FUNCTIONS ======

def fetch_candles(symbol, timeframe, limit):
    try:
        ohlcv = exchange.fetch_ohlcv(symbol, timeframe=timeframe, limit=limit)
        df = pd.DataFrame(ohlcv, columns=['timestamp', 'open', 'high', 'low', 'close', 'volume'])
        df['timestamp'] = pd.to_datetime(df['timestamp'], unit='ms')
        df.set_index('timestamp', inplace=True)
        return df
    except Exception as e:
        print(f"[ERROR] {symbol} {timeframe} fetch failed: {e}")
        return None


def add_indicators(df):
    df['rsi'] = RSIIndicator(close=df['close'], window=RSI_PERIOD).rsi()
    macd = MACD(close=df['close'], window_fast=MACD_FAST, window_slow=MACD_SLOW, window_sign=MACD_SIGNAL)
    df['macd_line'] = macd.macd()
    return df


def is_rsi_overbought(value):
    return RSI_OVERBOUGHT_LOW <= value <= RSI_OVERBOUGHT_HIGH


def detect_bearish_divergence(df):
    highs = df['high']
    rsi = df['rsi']
    macd_line = df['macd_line']

    local_highs = highs[(highs.shift(1) < highs) & (highs.shift(-1) < highs)]
    if len(local_highs) < 2:
        return False

    last_two = local_highs.sort_index(ascending=False).head(2).sort_index()
    idx1, idx2 = last_two.index

    p1, p2 = highs[idx1], highs[idx2]
    rsi1, rsi2 = rsi[idx1], rsi[idx2]
    macd1, macd2 = macd_line[idx1], macd_line[idx2]

    return (p2 > p1) and (rsi2 < rsi1) and (macd2 < macd1)


def send_discord_alert(symbol):
    now = datetime.now(ZoneInfo("Asia/Manila")).strftime('%Y-%m-%d %H:%M %Z')
    message = f"""üêª **Left Hand Alert**

**Symbol**: `{symbol}`
**Time**: {now}

**Conditions Met**:
- 15m RSI(30) between 60‚Äì70 ‚úÖ
- 5m Price: Higher High ‚¨ÜÔ∏è
- 5m RSI(30): Lower High üîª
- 5m MACD Line: Lower High üîª
===================================
"""
    payload = {"content": message}
    response = requests.post(DISCORD_WEBHOOK_URL, json=payload)
    if response.status_code == 204:
        print(f"[ALERT SENT] {symbol} at {now}")
    else:
        print(f"[ERROR] Failed to send alert for {symbol}: {response.status_code}")


# ====== MAIN CHECK ======

def check_symbol(symbol):
    # 15m timeframe check
    df_15m = fetch_candles(symbol, TIMEFRAME_RSI, CANDLE_LIMIT)
    if df_15m is None:
        return
    df_15m = add_indicators(df_15m)
    latest_rsi = df_15m['rsi'].dropna().iloc[-1]

    if not is_rsi_overbought(latest_rsi):
        print(f"[{symbol}] 15m RSI not overbought: {latest_rsi:.2f}")
        return

    # 5m timeframe divergence check
    df_5m = fetch_candles(symbol, TIMEFRAME_DIVERGENCE, CANDLE_LIMIT)
    if df_5m is None:
        return
    df_5m = add_indicators(df_5m)

    if detect_bearish_divergence(df_5m):
        send_discord_alert(symbol)
    else:
        print(f"[{symbol}] No Left Hand on 5m.")


def main():
    for symbol in OPTIONAL_PAIRS:
        check_symbol(symbol)


if __name__ == "__main__":
    main()

"""4HR BP LONG"""

import ccxt
import pandas as pd
import requests
from ta.momentum import RSIIndicator
from ta.trend import MACD
from datetime import datetime
from zoneinfo import ZoneInfo  # Python 3.9+

# ====== CONFIGURATION ======
DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1360566113225674790/eF49QfBo96Etb8FqqXY5vOKnmU8TpFcym1OGqrvIZmfGVAUxxaDTCaRX-CIod7VpHwP4'  # replace this
OPTIONAL_PAIRS = ['BTC-USDT-SWAP', 'ETH-USDT-SWAP', 'SOL-USDT-SWAP', 'XRP-USDT-SWAP', 'DOGE-USDT-SWAP', 'SUI-USDT-SWAP', 'BNB-USDT-SWAP', 'ADA-USDT-SWAP', 'AVAX-USDT-SWAP', 'OM-USDT-SWAP', 'LTC-USDT-SWAP', 'PEPE-USDT-SWAP', 'TRUMP-USDT-SWAP', 'ALCH-USDT-SWAP', 'BCH-USDT-SWAP', 'LINK-USDT-SWAP', 'TON-USDT-SWAP', 'TRX-USDT-SWAP', 'FARTCOIN-USDT-SWAP', 'AAVE-USDT-SWAP', 'CRV-USDT-SWAP', 'FIL-USDT-SWAP', 'DOT-USDT-SWAP', 'APT-USDT-SWAP', 'ONDO-USDT-SWAP', 'EOS-USDT-SWAP', 'SHIB-USDT-SWAP', 'LAYER-USDT-SWAP', 'ETC-USDT-SWAP', 'ORDI-USDT-SWAP', 'IP-USDT-SWAP', 'UNI-USDT-SWAP', 'PROMPT-USDT-SWAP', 'PNUT-USDT-SWAP', 'WLD-USDT-SWAP', 'OP-USDT-SWAP', 'NEAR-USDT-SWAP', 'HBAR-USDT-SWAP', 'MOVE-USDT-SWAP', 'PI-USDT-SWAP', 'XLM-USDT-SWAP', 'WIF-USDT-SWAP', 'HYPE-USDT-SWAP', 'LDO-USDT-SWAP', 'BABY-USDT-SWAP', 'VINE-USDT-SWAP', 'ZKJ-USDT-SWAP', 'AUCTION-USDT-SWAP', 'TIA-USDT-SWAP', 'SATS-USDT-SWAP', 'ATOM-USDT-SWAP', 'UXLINK-USDT-SWAP', 'ARB-USDT-SWAP', 'BERA-USDT-SWAP', 'PEOPLE-USDT-SWAP', 'BIGTIME-USDT-SWAP', 'KAITO-USDT-SWAP', 'CORE-USDT-SWAP', 'MKR-USDT-SWAP','ZRO-USDT-SWAP','GAS-USDT-SWAP','POPCAT-USDT-SWAP','CFX-USDT-SWAP','JUP-USDT-SWAP','AI16Z-USDT-SWAP','PARTI-USDT-SWAP','POL-USDT-SWAP','ACT-USDT-SWAP','S-USDT-SWAP','X-USDT-SWAP','DYDX-USDT-SWAP','TRB-USDT-SWAP','RENDER-USDT-SWAP','BONK-USDT-SWAP','XTZ-USDT-SWAP','NEO-USDT-SWAP','AIXBT-USDT-SWAP','MASK-USDT-SWAP','INJ-USDT-SWAP','STX-USDT-SWAP','ALGO-USDT-SWAP','GUN-USDT-SWAP','CRO-USDT-SWAP','LUNC-USDT-SWAP','ATH-USDT-SWAP','LPT-USDT-SWAP','MEW-USDT-SWAP','GALA-USDT-SWAP','ETHFI-USDT-SWAP','SONIC-USDT-SWAP','AXS-USDT-SWAP','TAO-USDT-SWAP','PENGU-USDT-SWAP','GRASS-USDT-SWAP','SAND-USDT-SWAP','API3-USDT-SWAP','ICP-USDT-SWAP','ENS-USDT-SWAP','JTO-USDT-SWAP','COMP-USDT-SWAP','NOT-USDT-SWAP','FLOKI-USDT-SWAP','NEIROETH-USDT-SWAP','W-USDT-SWAP','ACH-USDT-SWAP','BLUR-USDT-SWAP','IMX-USDT-SWAP','SHELL-USDT-SWAP','MANA-USDT-SWAP','STRK-USDT-SWAP','PYTH-USDT-SWAP','AR-USDT-SWAP','VIRTUAL-USDT-SWAP','NEIRO-USDT-SWAP','SUSHI-USDT-SWAP','RSR-USDT-SWAP','JELLYJELLY-USDT-SWAP','APE-USDT-SWAP','DOGS-USDT-SWAP','ZEREBRO-USDT-SWAP','OL-USDT-SWAP','YGG-USDT-SWAP','MOODENG-USDT-SWAP','CHZ-USDT-SWAP','RAY-USDT-SWAP','BSV-USDT-SWAP','EIGEN-USDT-SWAP','LOOKS-USDT-SWAP','GOAT-USDT-SWAP','YFI-USDT-SWAP','CATI-USDT-SWAP','XAUT-USDT-SWAP','ARC-USDT-SWAP','BOME-USDT-SWAP','AGLD-USDT-SWAP','ME-USDT-SWAP','ZETA-USDT-SWAP','TURBO-USDT-SWAP','ANIME-USDT-SWAP','J-USDT-SWAP','SSV-USDT-SWAP','ZRX-USDT-SWAP','HMSTR-USDT-SWAP','MERL-USDT-SWAP','SWARMS-USDT-SWAP','VANA-USDT-SWAP','MEMEFI-USDT-SWAP','MORPHO-USDT-SWAP','MEME-USDT-SWAP','DUCK-USDT-SWAP','GRT-USDT-SWAP','AEVO-USDT-SWAP','BR-USDT-SWAP','QTUM-USDT-SWAP','THETA-USDT-SWAP','GMT-USDT-SWAP','SNX-USDT-SWAP','STORJ-USDT-SWAP','FLOW-USDT-SWAP','ARKM-USDT-SWAP','GMX-USDT-SWAP','XCH-USDT-SWAP','CETUS-USDT-SWAP','NC-USDT-SWAP','USTC-USDT-SWAP','CVC-USDT-SWAP','ETHW-USDT-SWAP','VELO-USDT-SWAP','IOTA-USDT-SWAP','GRIFFAIN-USDT-SWAP','UMA-USDT-SWAP','ONT-USDT-SWAP','EGLD-USDT-SWAP','IOST-USDT-SWAP','GPS-USDT-SWAP','MAGIC-USDT-SWAP','METIS-USDT-SWAP','1INCH-USDT-SWAP','CVX-USDT-SWAP','GLM-USDT-SWAP','ULTI-USDT-SWAP','BADGER-USDT-SWAP','CAT-USDT-SWAP','CTC-USDT-SWAP','AIDOGE-USDT-SWAP','DGB-USDT-SWAP','ZIL-USDT-SWAP','BUZZ-USDT-SWAP','CELO-USDT-SWAP','BIO-USDT-SWAP','BAT-USDT-SWAP','MAJOR-USDT-SWAP','DEGEN-USDT-SWAP','ID-USDT-SWAP','JST-USDT-SWAP','KSM-USDT-SWAP','WOO-USDT-SWAP','MINA-USDT-SWAP','KNC-USDT-SWAP','LRC-USDT-SWAP','CSPR-USDT-SWAP','RDNT-USDT-SWAP','TNSR-USDT-SWAP','BAL-USDT-SWAP','RON-USDT-SWAP','PRCL-USDT-SWAP','SWEAT-USDT-SWAP','VRA-USDT-SWAP','LQTY-USDT-SWAP','PERP-USDT-SWAP','RVN-USDT-SWAP','PIPPIN-USDT-SWAP','ONE-USDT-SWAP','ORBS-USDT-SWAP','MOVR-USDT-SWAP','SWELL-USDT-SWAP','SCR-USDT-SWAP','FOXY-USDT-SWAP','T-USDT-SWAP','COOKIE-USDT-SWAP','FXS-USDT-SWAP','BICO-USDT-SWAP','AVAAI-USDT-SWAP','FLM-USDT-SWAP','SLP-USDT-SWAP','BAND-USDT-SWAP','NMR-USDT-SWAP','ACE-USDT-SWAP','JOE-USDT-SWAP','BRETT-USDT-SWAP','PUFFER-USDT-SWAP','NFT-USDT-SWAP','DOG-USDT-SWAP','BNT-USDT-SWAP','ZENT-USDT-SWAP','SLERF-USDT-SWAP','ICX-USDT-SWAP','ALPHA-USDT-SWAP','SUNDOG-USDT-SWAP','GODS-USDT-SWAP','WAXP-USDT-SWAP','LSK-USDT-SWAP','SOLV-USDT-SWAP','LUNA-USDT-SWAP','ZK-USDT-SWAP','ENJ-USDT-SWAP',
]  # Add more OKX USDT Futures pairs

RSI_PERIOD = 30
MACD_FAST = 12
MACD_SLOW = 26
MACD_SIGNAL = 9

RSI_OVERSOLD_LOW = 30
RSI_OVERSOLD_HIGH = 38

TIMEFRAME_RSI = '1h'
TIMEFRAME_DIVERGENCE = '15m'
CANDLE_LIMIT = 150

exchange = ccxt.okx()


# ====== HELPER FUNCTIONS ======

def fetch_candles(symbol, timeframe, limit):
    try:
        ohlcv = exchange.fetch_ohlcv(symbol, timeframe=timeframe, limit=limit)
        df = pd.DataFrame(ohlcv, columns=['timestamp', 'open', 'high', 'low', 'close', 'volume'])
        df['timestamp'] = pd.to_datetime(df['timestamp'], unit='ms')
        df.set_index('timestamp', inplace=True)
        return df
    except Exception as e:
        print(f"[ERROR] {symbol} {timeframe} fetch failed: {e}")
        return None


def add_indicators(df):
    df['rsi'] = RSIIndicator(close=df['close'], window=RSI_PERIOD).rsi()
    macd = MACD(close=df['close'], window_fast=MACD_FAST, window_slow=MACD_SLOW, window_sign=MACD_SIGNAL)
    df['macd_line'] = macd.macd()
    return df


def is_rsi_oversold(value):
    return RSI_OVERSOLD_LOW <= value <= RSI_OVERSOLD_HIGH


def detect_bullish_convergence(df):
    lows = df['low']
    rsi = df['rsi']
    macd_line = df['macd_line']

    local_lows = lows[(lows.shift(1) > lows) & (lows.shift(-1) > lows)]
    if len(local_lows) < 2:
        return False

    last_two = local_lows.sort_index(ascending=False).head(2).sort_index()
    idx1, idx2 = last_two.index

    p1, p2 = lows[idx1], lows[idx2]
    rsi1, rsi2 = rsi[idx1], rsi[idx2]
    macd1, macd2 = macd_line[idx1], macd_line[idx2]

    return (p2 < p1) and (rsi2 > rsi1) and (macd2 > macd1)


def send_discord_alert(symbol):
    now = datetime.now(ZoneInfo("Asia/Manila")).strftime('%Y-%m-%d %H:%M %Z')
    message = f"""üöÄ **Right Hand Alert**

**Symbol**: `{symbol}`
**Time**: {now}

**Conditions Met**:
- 1H RSI(30) between 30‚Äì38 ‚úÖ
- 15m Price: Lower Low üîª
- 15m RSI(30): Higher High ‚¨ÜÔ∏è
- 15m MACD Line: Higher High ‚¨ÜÔ∏è
=====================================
"""
    payload = {"content": message}
    response = requests.post(DISCORD_WEBHOOK_URL, json=payload)
    if response.status_code == 204:
        print(f"[ALERT SENT] {symbol} at {now}")
    else:
        print(f"[ERROR] Failed to send alert for {symbol}: {response.status_code}")


# ====== MAIN CHECK ======

def check_symbol(symbol):
    # 1h timeframe check
    df_1h = fetch_candles(symbol, TIMEFRAME_RSI, CANDLE_LIMIT)
    if df_1h is None:
        return
    df_1h = add_indicators(df_1h)
    latest_rsi = df_1h['rsi'].dropna().iloc[-1]

    if not is_rsi_oversold(latest_rsi):
        print(f"[{symbol}] 1H RSI not oversold: {latest_rsi:.2f}")
        return

    # 15m timeframe convergence check
    df_15m = fetch_candles(symbol, TIMEFRAME_DIVERGENCE, CANDLE_LIMIT)
    if df_15m is None:
        return
    df_15m = add_indicators(df_15m)

    if detect_bullish_convergence(df_15m):
        send_discord_alert(symbol)
    else:
        print(f"[{symbol}] No Right Hand on 15m.")


def main():
    for symbol in OPTIONAL_PAIRS:
        check_symbol(symbol)


if __name__ == "__main__":
    main()

"""4 HR BP SHORT"""

import ccxt
import pandas as pd
import requests
from ta.momentum import RSIIndicator
from ta.trend import MACD
from datetime import datetime
from zoneinfo import ZoneInfo  # Python 3.9+

# ==== CONFIGURATION ====
DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1360566710603612261/G0_CN54HSvPNBFx1nON9-maxUACSYzcBv59Igyjt2Heq-YnGxmQAb2gEAt2tCpOR96y8'  # Replace this
OPTIONAL_PAIRS = ['BTC-USDT-SWAP', 'ETH-USDT-SWAP', 'SOL-USDT-SWAP', 'XRP-USDT-SWAP', 'DOGE-USDT-SWAP', 'SUI-USDT-SWAP', 'BNB-USDT-SWAP', 'ADA-USDT-SWAP', 'AVAX-USDT-SWAP', 'OM-USDT-SWAP', 'LTC-USDT-SWAP', 'PEPE-USDT-SWAP', 'TRUMP-USDT-SWAP', 'ALCH-USDT-SWAP', 'BCH-USDT-SWAP', 'LINK-USDT-SWAP', 'TON-USDT-SWAP', 'TRX-USDT-SWAP', 'FARTCOIN-USDT-SWAP', 'AAVE-USDT-SWAP', 'CRV-USDT-SWAP', 'FIL-USDT-SWAP', 'DOT-USDT-SWAP', 'APT-USDT-SWAP', 'ONDO-USDT-SWAP', 'EOS-USDT-SWAP', 'SHIB-USDT-SWAP', 'LAYER-USDT-SWAP', 'ETC-USDT-SWAP', 'ORDI-USDT-SWAP', 'IP-USDT-SWAP', 'UNI-USDT-SWAP', 'PROMPT-USDT-SWAP', 'PNUT-USDT-SWAP', 'WLD-USDT-SWAP', 'OP-USDT-SWAP', 'NEAR-USDT-SWAP', 'HBAR-USDT-SWAP', 'MOVE-USDT-SWAP', 'PI-USDT-SWAP', 'XLM-USDT-SWAP', 'WIF-USDT-SWAP', 'HYPE-USDT-SWAP', 'LDO-USDT-SWAP', 'BABY-USDT-SWAP', 'VINE-USDT-SWAP', 'ZKJ-USDT-SWAP', 'AUCTION-USDT-SWAP', 'TIA-USDT-SWAP', 'SATS-USDT-SWAP', 'ATOM-USDT-SWAP', 'UXLINK-USDT-SWAP', 'ARB-USDT-SWAP', 'BERA-USDT-SWAP', 'PEOPLE-USDT-SWAP', 'BIGTIME-USDT-SWAP', 'KAITO-USDT-SWAP', 'CORE-USDT-SWAP', 'MKR-USDT-SWAP','ZRO-USDT-SWAP','GAS-USDT-SWAP','POPCAT-USDT-SWAP','CFX-USDT-SWAP','JUP-USDT-SWAP','AI16Z-USDT-SWAP','PARTI-USDT-SWAP','POL-USDT-SWAP','ACT-USDT-SWAP','S-USDT-SWAP','X-USDT-SWAP','DYDX-USDT-SWAP','TRB-USDT-SWAP','RENDER-USDT-SWAP','BONK-USDT-SWAP','XTZ-USDT-SWAP','NEO-USDT-SWAP','AIXBT-USDT-SWAP','MASK-USDT-SWAP','INJ-USDT-SWAP','STX-USDT-SWAP','ALGO-USDT-SWAP','GUN-USDT-SWAP','CRO-USDT-SWAP','LUNC-USDT-SWAP','ATH-USDT-SWAP','LPT-USDT-SWAP','MEW-USDT-SWAP','GALA-USDT-SWAP','ETHFI-USDT-SWAP','SONIC-USDT-SWAP','AXS-USDT-SWAP','TAO-USDT-SWAP','PENGU-USDT-SWAP','GRASS-USDT-SWAP','SAND-USDT-SWAP','API3-USDT-SWAP','ICP-USDT-SWAP','ENS-USDT-SWAP','JTO-USDT-SWAP','COMP-USDT-SWAP','NOT-USDT-SWAP','FLOKI-USDT-SWAP','NEIROETH-USDT-SWAP','W-USDT-SWAP','ACH-USDT-SWAP','BLUR-USDT-SWAP','IMX-USDT-SWAP','SHELL-USDT-SWAP','MANA-USDT-SWAP','STRK-USDT-SWAP','PYTH-USDT-SWAP','AR-USDT-SWAP','VIRTUAL-USDT-SWAP','NEIRO-USDT-SWAP','SUSHI-USDT-SWAP','RSR-USDT-SWAP','JELLYJELLY-USDT-SWAP','APE-USDT-SWAP','DOGS-USDT-SWAP','ZEREBRO-USDT-SWAP','OL-USDT-SWAP','YGG-USDT-SWAP','MOODENG-USDT-SWAP','CHZ-USDT-SWAP','RAY-USDT-SWAP','BSV-USDT-SWAP','EIGEN-USDT-SWAP','LOOKS-USDT-SWAP','GOAT-USDT-SWAP','YFI-USDT-SWAP','CATI-USDT-SWAP','XAUT-USDT-SWAP','ARC-USDT-SWAP','BOME-USDT-SWAP','AGLD-USDT-SWAP','ME-USDT-SWAP','ZETA-USDT-SWAP','TURBO-USDT-SWAP','ANIME-USDT-SWAP','J-USDT-SWAP','SSV-USDT-SWAP','ZRX-USDT-SWAP','HMSTR-USDT-SWAP','MERL-USDT-SWAP','SWARMS-USDT-SWAP','VANA-USDT-SWAP','MEMEFI-USDT-SWAP','MORPHO-USDT-SWAP','MEME-USDT-SWAP','DUCK-USDT-SWAP','GRT-USDT-SWAP','AEVO-USDT-SWAP','BR-USDT-SWAP','QTUM-USDT-SWAP','THETA-USDT-SWAP','GMT-USDT-SWAP','SNX-USDT-SWAP','STORJ-USDT-SWAP','FLOW-USDT-SWAP','ARKM-USDT-SWAP','GMX-USDT-SWAP','XCH-USDT-SWAP','CETUS-USDT-SWAP','NC-USDT-SWAP','USTC-USDT-SWAP','CVC-USDT-SWAP','ETHW-USDT-SWAP','VELO-USDT-SWAP','IOTA-USDT-SWAP','GRIFFAIN-USDT-SWAP','UMA-USDT-SWAP','ONT-USDT-SWAP','EGLD-USDT-SWAP','IOST-USDT-SWAP','GPS-USDT-SWAP','MAGIC-USDT-SWAP','METIS-USDT-SWAP','1INCH-USDT-SWAP','CVX-USDT-SWAP','GLM-USDT-SWAP','ULTI-USDT-SWAP','BADGER-USDT-SWAP','CAT-USDT-SWAP','CTC-USDT-SWAP','AIDOGE-USDT-SWAP','DGB-USDT-SWAP','ZIL-USDT-SWAP','BUZZ-USDT-SWAP','CELO-USDT-SWAP','BIO-USDT-SWAP','BAT-USDT-SWAP','MAJOR-USDT-SWAP','DEGEN-USDT-SWAP','ID-USDT-SWAP','JST-USDT-SWAP','KSM-USDT-SWAP','WOO-USDT-SWAP','MINA-USDT-SWAP','KNC-USDT-SWAP','LRC-USDT-SWAP','CSPR-USDT-SWAP','RDNT-USDT-SWAP','TNSR-USDT-SWAP','BAL-USDT-SWAP','RON-USDT-SWAP','PRCL-USDT-SWAP','SWEAT-USDT-SWAP','VRA-USDT-SWAP','LQTY-USDT-SWAP','PERP-USDT-SWAP','RVN-USDT-SWAP','PIPPIN-USDT-SWAP','ONE-USDT-SWAP','ORBS-USDT-SWAP','MOVR-USDT-SWAP','SWELL-USDT-SWAP','SCR-USDT-SWAP','FOXY-USDT-SWAP','T-USDT-SWAP','COOKIE-USDT-SWAP','FXS-USDT-SWAP','BICO-USDT-SWAP','AVAAI-USDT-SWAP','FLM-USDT-SWAP','SLP-USDT-SWAP','BAND-USDT-SWAP','NMR-USDT-SWAP','ACE-USDT-SWAP','JOE-USDT-SWAP','BRETT-USDT-SWAP','PUFFER-USDT-SWAP','NFT-USDT-SWAP','DOG-USDT-SWAP','BNT-USDT-SWAP','ZENT-USDT-SWAP','SLERF-USDT-SWAP','ICX-USDT-SWAP','ALPHA-USDT-SWAP','SUNDOG-USDT-SWAP','GODS-USDT-SWAP','WAXP-USDT-SWAP','LSK-USDT-SWAP','SOLV-USDT-SWAP','LUNA-USDT-SWAP','ZK-USDT-SWAP','ENJ-USDT-SWAP',
]  # Add your target pairs here

RSI_PERIOD = 30
MACD_FAST = 12
MACD_SLOW = 26
MACD_SIGNAL = 9

RSI_OVERBOUGHT_LOW = 60
RSI_OVERBOUGHT_HIGH = 70

RSI_TIMEFRAME = '1h'
DIVERGENCE_TIMEFRAME = '15m'
CANDLE_LIMIT = 150

exchange = ccxt.okx()


# ==== HELPER FUNCTIONS ====

def fetch_candles(symbol, timeframe, limit):
    try:
        ohlcv = exchange.fetch_ohlcv(symbol, timeframe=timeframe, limit=limit)
        df = pd.DataFrame(ohlcv, columns=['timestamp', 'open', 'high', 'low', 'close', 'volume'])
        df['timestamp'] = pd.to_datetime(df['timestamp'], unit='ms')
        df.set_index('timestamp', inplace=True)
        return df
    except Exception as e:
        print(f"[ERROR] {symbol} {timeframe} fetch failed: {e}")
        return None


def add_indicators(df):
    df['rsi'] = RSIIndicator(close=df['close'], window=RSI_PERIOD).rsi()
    macd = MACD(close=df['close'], window_fast=MACD_FAST, window_slow=MACD_SLOW, window_sign=MACD_SIGNAL)
    df['macd_line'] = macd.macd()
    return df


def is_rsi_overbought(value):
    return RSI_OVERBOUGHT_LOW <= value <= RSI_OVERBOUGHT_HIGH


def detect_bearish_divergence(df):
    highs = df['high']
    rsi = df['rsi']
    macd_line = df['macd_line']

    # Find local highs
    local_highs = highs[(highs.shift(1) < highs) & (highs.shift(-1) < highs)]
    if len(local_highs) < 2:
        return False

    # Take last two local highs
    last_two = local_highs.sort_index(ascending=False).head(2).sort_index()
    idx1, idx2 = last_two.index

    # Extract values
    p1, p2 = highs[idx1], highs[idx2]
    rsi1, rsi2 = rsi[idx1], rsi[idx2]
    macd1, macd2 = macd_line[idx1], macd_line[idx2]

    return (p2 > p1) and (rsi2 < rsi1) and (macd2 < macd1)


def send_discord_alert(symbol):
    now = datetime.now(ZoneInfo("Asia/Manila")).strftime('%Y-%m-%d %H:%M %Z')
    message = f"""üêª **Left Hand Alert**

**Symbol**: `{symbol}`
**Time**: {now}

**Conditions Met**:
- 1H RSI(30) between 60‚Äì70 ‚úÖ
- 15m Price: Higher High ‚¨ÜÔ∏è
- 15m RSI(30): Lower High üîª
- 15m MACD Line: Lower High üîª
======================================
"""
    payload = {"content": message}
    response = requests.post(DISCORD_WEBHOOK_URL, json=payload)
    if response.status_code == 204:
        print(f"[ALERT SENT] {symbol} at {now}")
    else:
        print(f"[ERROR] Failed to send alert for {symbol}: {response.status_code}")


# ==== MAIN LOGIC ====

def check_symbol(symbol):
    # 1H timeframe check
    df_1h = fetch_candles(symbol, RSI_TIMEFRAME, CANDLE_LIMIT)
    if df_1h is None:
        return
    df_1h = add_indicators(df_1h)
    latest_rsi = df_1h['rsi'].dropna().iloc[-1]

    if not is_rsi_overbought(latest_rsi):
        print(f"[{symbol}] 1H RSI not in range: {latest_rsi:.2f}")
        return

    # 15m timeframe divergence check
    df_15m = fetch_candles(symbol, DIVERGENCE_TIMEFRAME, CANDLE_LIMIT)
    if df_15m is None:
        return
    df_15m = add_indicators(df_15m)

    if detect_bearish_divergence(df_15m):
        send_discord_alert(symbol)
    else:
        print(f"[{symbol}] No Left Hand on 15m.")


def main():
    for symbol in OPTIONAL_PAIRS:
        check_symbol(symbol)


if __name__ == "__main__":
    main()

"""1DAY BP LONG SETUP"""

import ccxt
import pandas as pd
import requests
from ta.momentum import RSIIndicator
from ta.trend import MACD
from datetime import datetime
from zoneinfo import ZoneInfo  # Python 3.9+

# ====== CONFIGURATION ======
DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1360872596358299691/dRoxCbuydN3Mp2e8NAYh4LlINRD5nQanNvGaVTI1GMbGp7KHU-5SjR9a14RZkombsGp3'  # replace this
OPTIONAL_PAIRS = ['BTC-USDT-SWAP', 'ETH-USDT-SWAP', 'SOL-USDT-SWAP', 'XRP-USDT-SWAP', 'DOGE-USDT-SWAP', 'SUI-USDT-SWAP', 'BNB-USDT-SWAP', 'ADA-USDT-SWAP', 'AVAX-USDT-SWAP', 'OM-USDT-SWAP', 'LTC-USDT-SWAP', 'PEPE-USDT-SWAP', 'TRUMP-USDT-SWAP', 'ALCH-USDT-SWAP', 'BCH-USDT-SWAP', 'LINK-USDT-SWAP', 'TON-USDT-SWAP', 'TRX-USDT-SWAP', 'FARTCOIN-USDT-SWAP', 'AAVE-USDT-SWAP', 'CRV-USDT-SWAP', 'FIL-USDT-SWAP', 'DOT-USDT-SWAP', 'APT-USDT-SWAP', 'ONDO-USDT-SWAP', 'EOS-USDT-SWAP', 'SHIB-USDT-SWAP', 'LAYER-USDT-SWAP', 'ETC-USDT-SWAP', 'ORDI-USDT-SWAP', 'IP-USDT-SWAP', 'UNI-USDT-SWAP', 'PROMPT-USDT-SWAP', 'PNUT-USDT-SWAP', 'WLD-USDT-SWAP', 'OP-USDT-SWAP', 'NEAR-USDT-SWAP', 'HBAR-USDT-SWAP', 'MOVE-USDT-SWAP', 'PI-USDT-SWAP', 'XLM-USDT-SWAP', 'WIF-USDT-SWAP', 'HYPE-USDT-SWAP', 'LDO-USDT-SWAP', 'BABY-USDT-SWAP', 'VINE-USDT-SWAP', 'ZKJ-USDT-SWAP', 'AUCTION-USDT-SWAP', 'TIA-USDT-SWAP', 'SATS-USDT-SWAP', 'ATOM-USDT-SWAP', 'UXLINK-USDT-SWAP', 'ARB-USDT-SWAP', 'BERA-USDT-SWAP', 'PEOPLE-USDT-SWAP', 'BIGTIME-USDT-SWAP', 'KAITO-USDT-SWAP', 'CORE-USDT-SWAP', 'MKR-USDT-SWAP','ZRO-USDT-SWAP','GAS-USDT-SWAP','POPCAT-USDT-SWAP','CFX-USDT-SWAP','JUP-USDT-SWAP','AI16Z-USDT-SWAP','PARTI-USDT-SWAP','POL-USDT-SWAP','ACT-USDT-SWAP','S-USDT-SWAP','X-USDT-SWAP','DYDX-USDT-SWAP','TRB-USDT-SWAP','RENDER-USDT-SWAP','BONK-USDT-SWAP','XTZ-USDT-SWAP','NEO-USDT-SWAP','AIXBT-USDT-SWAP','MASK-USDT-SWAP','INJ-USDT-SWAP','STX-USDT-SWAP','ALGO-USDT-SWAP','GUN-USDT-SWAP','CRO-USDT-SWAP','LUNC-USDT-SWAP','ATH-USDT-SWAP','LPT-USDT-SWAP','MEW-USDT-SWAP','GALA-USDT-SWAP','ETHFI-USDT-SWAP','SONIC-USDT-SWAP','AXS-USDT-SWAP','TAO-USDT-SWAP','PENGU-USDT-SWAP','GRASS-USDT-SWAP','SAND-USDT-SWAP','API3-USDT-SWAP','ICP-USDT-SWAP','ENS-USDT-SWAP','JTO-USDT-SWAP','COMP-USDT-SWAP','NOT-USDT-SWAP','FLOKI-USDT-SWAP','NEIROETH-USDT-SWAP','W-USDT-SWAP','ACH-USDT-SWAP','BLUR-USDT-SWAP','IMX-USDT-SWAP','SHELL-USDT-SWAP','MANA-USDT-SWAP','STRK-USDT-SWAP','PYTH-USDT-SWAP','AR-USDT-SWAP','VIRTUAL-USDT-SWAP','NEIRO-USDT-SWAP','SUSHI-USDT-SWAP','RSR-USDT-SWAP','JELLYJELLY-USDT-SWAP','APE-USDT-SWAP','DOGS-USDT-SWAP','ZEREBRO-USDT-SWAP','OL-USDT-SWAP','YGG-USDT-SWAP','MOODENG-USDT-SWAP','CHZ-USDT-SWAP','RAY-USDT-SWAP','BSV-USDT-SWAP','EIGEN-USDT-SWAP','LOOKS-USDT-SWAP','GOAT-USDT-SWAP','YFI-USDT-SWAP','CATI-USDT-SWAP','XAUT-USDT-SWAP','ARC-USDT-SWAP','BOME-USDT-SWAP','AGLD-USDT-SWAP','ME-USDT-SWAP','ZETA-USDT-SWAP','TURBO-USDT-SWAP','ANIME-USDT-SWAP','J-USDT-SWAP','SSV-USDT-SWAP','ZRX-USDT-SWAP','HMSTR-USDT-SWAP','MERL-USDT-SWAP','SWARMS-USDT-SWAP','VANA-USDT-SWAP','MEMEFI-USDT-SWAP','MORPHO-USDT-SWAP','MEME-USDT-SWAP','DUCK-USDT-SWAP','GRT-USDT-SWAP','AEVO-USDT-SWAP','BR-USDT-SWAP','QTUM-USDT-SWAP','THETA-USDT-SWAP','GMT-USDT-SWAP','SNX-USDT-SWAP','STORJ-USDT-SWAP','FLOW-USDT-SWAP','ARKM-USDT-SWAP','GMX-USDT-SWAP','XCH-USDT-SWAP','CETUS-USDT-SWAP','NC-USDT-SWAP','USTC-USDT-SWAP','CVC-USDT-SWAP','ETHW-USDT-SWAP','VELO-USDT-SWAP','IOTA-USDT-SWAP','GRIFFAIN-USDT-SWAP','UMA-USDT-SWAP','ONT-USDT-SWAP','EGLD-USDT-SWAP','IOST-USDT-SWAP','GPS-USDT-SWAP','MAGIC-USDT-SWAP','METIS-USDT-SWAP','1INCH-USDT-SWAP','CVX-USDT-SWAP','GLM-USDT-SWAP','ULTI-USDT-SWAP','BADGER-USDT-SWAP','CAT-USDT-SWAP','CTC-USDT-SWAP','AIDOGE-USDT-SWAP','DGB-USDT-SWAP','ZIL-USDT-SWAP','BUZZ-USDT-SWAP','CELO-USDT-SWAP','BIO-USDT-SWAP','BAT-USDT-SWAP','MAJOR-USDT-SWAP','DEGEN-USDT-SWAP','ID-USDT-SWAP','JST-USDT-SWAP','KSM-USDT-SWAP','WOO-USDT-SWAP','MINA-USDT-SWAP','KNC-USDT-SWAP','LRC-USDT-SWAP','CSPR-USDT-SWAP','RDNT-USDT-SWAP','TNSR-USDT-SWAP','BAL-USDT-SWAP','RON-USDT-SWAP','PRCL-USDT-SWAP','SWEAT-USDT-SWAP','VRA-USDT-SWAP','LQTY-USDT-SWAP','PERP-USDT-SWAP','RVN-USDT-SWAP','PIPPIN-USDT-SWAP','ONE-USDT-SWAP','ORBS-USDT-SWAP','MOVR-USDT-SWAP','SWELL-USDT-SWAP','SCR-USDT-SWAP','FOXY-USDT-SWAP','T-USDT-SWAP','COOKIE-USDT-SWAP','FXS-USDT-SWAP','BICO-USDT-SWAP','AVAAI-USDT-SWAP','FLM-USDT-SWAP','SLP-USDT-SWAP','BAND-USDT-SWAP','NMR-USDT-SWAP','ACE-USDT-SWAP','JOE-USDT-SWAP','BRETT-USDT-SWAP','PUFFER-USDT-SWAP','NFT-USDT-SWAP','DOG-USDT-SWAP','BNT-USDT-SWAP','ZENT-USDT-SWAP','SLERF-USDT-SWAP','ICX-USDT-SWAP','ALPHA-USDT-SWAP','SUNDOG-USDT-SWAP','GODS-USDT-SWAP','WAXP-USDT-SWAP','LSK-USDT-SWAP','SOLV-USDT-SWAP','LUNA-USDT-SWAP','ZK-USDT-SWAP','ENJ-USDT-SWAP',]  # Add more OKX USDT Futures pairs

RSI_PERIOD = 30
MACD_FAST = 12
MACD_SLOW = 26
MACD_SIGNAL = 9

RSI_OVERSOLD_LOW = 30
RSI_OVERSOLD_HIGH = 40

TIMEFRAME_RSI = '4h'
TIMEFRAME_CONVERGENCE = '1h'
CANDLE_LIMIT = 150

exchange = ccxt.okx()


# ====== HELPER FUNCTIONS ======

def fetch_candles(symbol, timeframe, limit):
    try:
        ohlcv = exchange.fetch_ohlcv(symbol, timeframe=timeframe, limit=limit)
        df = pd.DataFrame(ohlcv, columns=['timestamp', 'open', 'high', 'low', 'close', 'volume'])
        df['timestamp'] = pd.to_datetime(df['timestamp'], unit='ms')
        df.set_index('timestamp', inplace=True)
        return df
    except Exception as e:
        print(f"[ERROR] {symbol} {timeframe} fetch failed: {e}")
        return None


def add_indicators(df):
    df['rsi'] = RSIIndicator(close=df['close'], window=RSI_PERIOD).rsi()
    macd = MACD(close=df['close'], window_fast=MACD_FAST, window_slow=MACD_SLOW, window_sign=MACD_SIGNAL)
    df['macd_line'] = macd.macd()
    return df


def is_rsi_oversold(value):
    return RSI_OVERSOLD_LOW <= value <= RSI_OVERSOLD_HIGH


def detect_bullish_convergence(df):
    lows = df['low']
    rsi = df['rsi']
    macd_line = df['macd_line']

    local_lows = lows[(lows.shift(1) > lows) & (lows.shift(-1) > lows)]
    if len(local_lows) < 2:
        return False

    last_two = local_lows.sort_index(ascending=False).head(2).sort_index()
    if len(last_two) < 2:
        return False

    idx1, idx2 = last_two.index

    try:
        p1, p2 = lows[idx1], lows[idx2]
        rsi1, rsi2 = rsi[idx1], rsi[idx2]
        macd1, macd2 = macd_line[idx1], macd_line[idx2]
    except KeyError:
        return False

    return (p2 < p1) and (rsi2 > rsi1) and (macd2 > macd1)


def send_discord_alert(symbol):
    now = datetime.now(ZoneInfo("Asia/Manila")).strftime('%Y-%m-%d %H:%M %Z')
    message = f"""üöÄ **Right Hand Alert**

**Symbol**: `{symbol}`
**Time**: {now}

**Conditions Met**:
- 4H RSI(30) between 30‚Äì40 ‚úÖ
- 1H Price: Lower Low üîª
- 1H RSI(30): Higher High ‚¨ÜÔ∏è
- 1H MACD Line: Higher High ‚¨ÜÔ∏è
==================================
"""
    payload = {"content": message}
    response = requests.post(DISCORD_WEBHOOK_URL, json=payload)
    if response.status_code == 204:
        print(f"[ALERT SENT] {symbol} at {now}")
    else:
        print(f"[ERROR] Failed to send alert for {symbol}: {response.status_code}")


# ====== MAIN CHECK ======

def check_symbol(symbol):
    # 4h timeframe check
    df_4h = fetch_candles(symbol, TIMEFRAME_RSI, CANDLE_LIMIT)
    if df_4h is None:
        return
    df_4h = add_indicators(df_4h)
    if df_4h['rsi'].dropna().empty:
        print(f"[{symbol}] 4H RSI data not available.")
        return

    latest_rsi = df_4h['rsi'].dropna().iloc[-1]

    if not is_rsi_oversold(latest_rsi):
        print(f"[{symbol}] 4H RSI not oversold: {latest_rsi:.2f}")
        return

    # 1h timeframe convergence check
    df_1h = fetch_candles(symbol, TIMEFRAME_CONVERGENCE, CANDLE_LIMIT)
    if df_1h is None:
        return
    df_1h = add_indicators(df_1h)

    if detect_bullish_convergence(df_1h):
        send_discord_alert(symbol)
    else:
        print(f"[{symbol}] No Right Hand on 1H.")


def main():
    for symbol in OPTIONAL_PAIRS:
        check_symbol(symbol)


if __name__ == "__main__":
    main()

"""1DAY BP SHORT SETUP"""

import ccxt
import pandas as pd
import requests
from ta.momentum import RSIIndicator
from ta.trend import MACD
from datetime import datetime
from zoneinfo import ZoneInfo  # Python 3.9+

# ====== CONFIGURATION ======
DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1360875272752337097/ub5xJnFUKXuNmimYHmv3yU_ORktyNjMp9wVQZk2rO3IsCo9CtiR_qDzUYIIhWemq9H1i'  # replace this
OPTIONAL_PAIRS = ['BTC-USDT-SWAP', 'ETH-USDT-SWAP', 'SOL-USDT-SWAP', 'XRP-USDT-SWAP', 'DOGE-USDT-SWAP', 'SUI-USDT-SWAP', 'BNB-USDT-SWAP', 'ADA-USDT-SWAP', 'AVAX-USDT-SWAP', 'OM-USDT-SWAP', 'LTC-USDT-SWAP', 'PEPE-USDT-SWAP', 'TRUMP-USDT-SWAP', 'ALCH-USDT-SWAP', 'BCH-USDT-SWAP', 'LINK-USDT-SWAP', 'TON-USDT-SWAP', 'TRX-USDT-SWAP', 'FARTCOIN-USDT-SWAP', 'AAVE-USDT-SWAP', 'CRV-USDT-SWAP', 'FIL-USDT-SWAP', 'DOT-USDT-SWAP', 'APT-USDT-SWAP', 'ONDO-USDT-SWAP', 'EOS-USDT-SWAP', 'SHIB-USDT-SWAP', 'LAYER-USDT-SWAP', 'ETC-USDT-SWAP', 'ORDI-USDT-SWAP', 'IP-USDT-SWAP', 'UNI-USDT-SWAP', 'PROMPT-USDT-SWAP', 'PNUT-USDT-SWAP', 'WLD-USDT-SWAP', 'OP-USDT-SWAP', 'NEAR-USDT-SWAP', 'HBAR-USDT-SWAP', 'MOVE-USDT-SWAP', 'PI-USDT-SWAP', 'XLM-USDT-SWAP', 'WIF-USDT-SWAP', 'HYPE-USDT-SWAP', 'LDO-USDT-SWAP', 'BABY-USDT-SWAP', 'VINE-USDT-SWAP', 'ZKJ-USDT-SWAP', 'AUCTION-USDT-SWAP', 'TIA-USDT-SWAP', 'SATS-USDT-SWAP', 'ATOM-USDT-SWAP', 'UXLINK-USDT-SWAP', 'ARB-USDT-SWAP', 'BERA-USDT-SWAP', 'PEOPLE-USDT-SWAP', 'BIGTIME-USDT-SWAP', 'KAITO-USDT-SWAP', 'CORE-USDT-SWAP', 'MKR-USDT-SWAP','ZRO-USDT-SWAP','GAS-USDT-SWAP','POPCAT-USDT-SWAP','CFX-USDT-SWAP','JUP-USDT-SWAP','AI16Z-USDT-SWAP','PARTI-USDT-SWAP','POL-USDT-SWAP','ACT-USDT-SWAP','S-USDT-SWAP','X-USDT-SWAP','DYDX-USDT-SWAP','TRB-USDT-SWAP','RENDER-USDT-SWAP','BONK-USDT-SWAP','XTZ-USDT-SWAP','NEO-USDT-SWAP','AIXBT-USDT-SWAP','MASK-USDT-SWAP','INJ-USDT-SWAP','STX-USDT-SWAP','ALGO-USDT-SWAP','GUN-USDT-SWAP','CRO-USDT-SWAP','LUNC-USDT-SWAP','ATH-USDT-SWAP','LPT-USDT-SWAP','MEW-USDT-SWAP','GALA-USDT-SWAP','ETHFI-USDT-SWAP','SONIC-USDT-SWAP','AXS-USDT-SWAP','TAO-USDT-SWAP','PENGU-USDT-SWAP','GRASS-USDT-SWAP','SAND-USDT-SWAP','API3-USDT-SWAP','ICP-USDT-SWAP','ENS-USDT-SWAP','JTO-USDT-SWAP','COMP-USDT-SWAP','NOT-USDT-SWAP','FLOKI-USDT-SWAP','NEIROETH-USDT-SWAP','W-USDT-SWAP','ACH-USDT-SWAP','BLUR-USDT-SWAP','IMX-USDT-SWAP','SHELL-USDT-SWAP','MANA-USDT-SWAP','STRK-USDT-SWAP','PYTH-USDT-SWAP','AR-USDT-SWAP','VIRTUAL-USDT-SWAP','NEIRO-USDT-SWAP','SUSHI-USDT-SWAP','RSR-USDT-SWAP','JELLYJELLY-USDT-SWAP','APE-USDT-SWAP','DOGS-USDT-SWAP','ZEREBRO-USDT-SWAP','OL-USDT-SWAP','YGG-USDT-SWAP','MOODENG-USDT-SWAP','CHZ-USDT-SWAP','RAY-USDT-SWAP','BSV-USDT-SWAP','EIGEN-USDT-SWAP','LOOKS-USDT-SWAP','GOAT-USDT-SWAP','YFI-USDT-SWAP','CATI-USDT-SWAP','XAUT-USDT-SWAP','ARC-USDT-SWAP','BOME-USDT-SWAP','AGLD-USDT-SWAP','ME-USDT-SWAP','ZETA-USDT-SWAP','TURBO-USDT-SWAP','ANIME-USDT-SWAP','J-USDT-SWAP','SSV-USDT-SWAP','ZRX-USDT-SWAP','HMSTR-USDT-SWAP','MERL-USDT-SWAP','SWARMS-USDT-SWAP','VANA-USDT-SWAP','MEMEFI-USDT-SWAP','MORPHO-USDT-SWAP','MEME-USDT-SWAP','DUCK-USDT-SWAP','GRT-USDT-SWAP','AEVO-USDT-SWAP','BR-USDT-SWAP','QTUM-USDT-SWAP','THETA-USDT-SWAP','GMT-USDT-SWAP','SNX-USDT-SWAP','STORJ-USDT-SWAP','FLOW-USDT-SWAP','ARKM-USDT-SWAP','GMX-USDT-SWAP','XCH-USDT-SWAP','CETUS-USDT-SWAP','NC-USDT-SWAP','USTC-USDT-SWAP','CVC-USDT-SWAP','ETHW-USDT-SWAP','VELO-USDT-SWAP','IOTA-USDT-SWAP','GRIFFAIN-USDT-SWAP','UMA-USDT-SWAP','ONT-USDT-SWAP','EGLD-USDT-SWAP','IOST-USDT-SWAP','GPS-USDT-SWAP','MAGIC-USDT-SWAP','METIS-USDT-SWAP','1INCH-USDT-SWAP','CVX-USDT-SWAP','GLM-USDT-SWAP','ULTI-USDT-SWAP','BADGER-USDT-SWAP','CAT-USDT-SWAP','CTC-USDT-SWAP','AIDOGE-USDT-SWAP','DGB-USDT-SWAP','ZIL-USDT-SWAP','BUZZ-USDT-SWAP','CELO-USDT-SWAP','BIO-USDT-SWAP','BAT-USDT-SWAP','MAJOR-USDT-SWAP','DEGEN-USDT-SWAP','ID-USDT-SWAP','JST-USDT-SWAP','KSM-USDT-SWAP','WOO-USDT-SWAP','MINA-USDT-SWAP','KNC-USDT-SWAP','LRC-USDT-SWAP','CSPR-USDT-SWAP','RDNT-USDT-SWAP','TNSR-USDT-SWAP','BAL-USDT-SWAP','RON-USDT-SWAP','PRCL-USDT-SWAP','SWEAT-USDT-SWAP','VRA-USDT-SWAP','LQTY-USDT-SWAP','PERP-USDT-SWAP','RVN-USDT-SWAP','PIPPIN-USDT-SWAP','ONE-USDT-SWAP','ORBS-USDT-SWAP','MOVR-USDT-SWAP','SWELL-USDT-SWAP','SCR-USDT-SWAP','FOXY-USDT-SWAP','T-USDT-SWAP','COOKIE-USDT-SWAP','FXS-USDT-SWAP','BICO-USDT-SWAP','AVAAI-USDT-SWAP','FLM-USDT-SWAP','SLP-USDT-SWAP','BAND-USDT-SWAP','NMR-USDT-SWAP','ACE-USDT-SWAP','JOE-USDT-SWAP','BRETT-USDT-SWAP','PUFFER-USDT-SWAP','NFT-USDT-SWAP','DOG-USDT-SWAP','BNT-USDT-SWAP','ZENT-USDT-SWAP','SLERF-USDT-SWAP','ICX-USDT-SWAP','ALPHA-USDT-SWAP','SUNDOG-USDT-SWAP','GODS-USDT-SWAP','WAXP-USDT-SWAP','LSK-USDT-SWAP','SOLV-USDT-SWAP','LUNA-USDT-SWAP','ZK-USDT-SWAP','ENJ-USDT-SWAP',
]  # Add more OKX USDT Futures pairs

RSI_PERIOD = 30
MACD_FAST = 12
MACD_SLOW = 26
MACD_SIGNAL = 9

RSI_OVERBOUGHT_LOW = 60
RSI_OVERBOUGHT_HIGH = 70

TIMEFRAME_RSI = '4h'
TIMEFRAME_DIVERGENCE = '1h'
CANDLE_LIMIT = 150

exchange = ccxt.okx()


# ====== HELPER FUNCTIONS ======

def fetch_candles(symbol, timeframe, limit):
    try:
        ohlcv = exchange.fetch_ohlcv(symbol, timeframe=timeframe, limit=limit)
        df = pd.DataFrame(ohlcv, columns=['timestamp', 'open', 'high', 'low', 'close', 'volume'])
        df['timestamp'] = pd.to_datetime(df['timestamp'], unit='ms')
        df.set_index('timestamp', inplace=True)
        return df
    except Exception as e:
        print(f"[ERROR] {symbol} {timeframe} fetch failed: {e}")
        return None


def add_indicators(df):
    df['rsi'] = RSIIndicator(close=df['close'], window=RSI_PERIOD).rsi()
    macd = MACD(close=df['close'], window_fast=MACD_FAST, window_slow=MACD_SLOW, window_sign=MACD_SIGNAL)
    df['macd_line'] = macd.macd()
    return df


def is_rsi_overbought(value):
    return RSI_OVERBOUGHT_LOW <= value <= RSI_OVERBOUGHT_HIGH


def detect_bearish_divergence(df):
    highs = df['high']
    rsi = df['rsi']
    macd_line = df['macd_line']

    local_highs = highs[(highs.shift(1) < highs) & (highs.shift(-1) < highs)]
    if len(local_highs) < 2:
        return False

    last_two = local_highs.sort_index(ascending=False).head(2).sort_index()
    if len(last_two) < 2:
        return False

    idx1, idx2 = last_two.index

    try:
        p1, p2 = highs[idx1], highs[idx2]
        rsi1, rsi2 = rsi[idx1], rsi[idx2]
        macd1, macd2 = macd_line[idx1], macd_line[idx2]
    except KeyError:
        return False

    return (p2 > p1) and (rsi2 < rsi1) and (macd2 < macd1)


def send_discord_alert(symbol):
    now = datetime.now(ZoneInfo("Asia/Manila")).strftime('%Y-%m-%d %H:%M %Z')
    message = f"""\nüêª **Left Hand Alert**

**Symbol**: `{symbol}`
**Time**: {now}

**Conditions Met**:
- 4H RSI(30) between 60‚Äì70 ‚úÖ
- 1H Price: Higher High ‚¨ÜÔ∏è
- 1H RSI(30): Lower High üîª
- 1H MACD Line: Lower High üîª
====================================
"""
    payload = {"content": message}
    response = requests.post(DISCORD_WEBHOOK_URL, json=payload)
    if response.status_code == 204:
        print(f"[ALERT SENT] {symbol} at {now}")
    else:
        print(f"[ERROR] Failed to send alert for {symbol}: {response.status_code}")


# ====== MAIN CHECK ======

def check_symbol(symbol):
    # 4h timeframe check
    df_4h = fetch_candles(symbol, TIMEFRAME_RSI, CANDLE_LIMIT)
    if df_4h is None:
        return
    df_4h = add_indicators(df_4h)
    if df_4h['rsi'].dropna().empty:
        print(f"[{symbol}] 4H RSI data not available.")
        return

    latest_rsi = df_4h['rsi'].dropna().iloc[-1]

    if not is_rsi_overbought(latest_rsi):
        print(f"[{symbol}] 4H RSI not overbought: {latest_rsi:.2f}")
        return

    # 1h timeframe divergence check
    df_1h = fetch_candles(symbol, TIMEFRAME_DIVERGENCE, CANDLE_LIMIT)
    if df_1h is None:
        return
    df_1h = add_indicators(df_1h)

    if detect_bearish_divergence(df_1h):
        send_discord_alert(symbol)
    else:
        print(f"[{symbol}] No Left Hand on 1H.")


def main():
    for symbol in OPTIONAL_PAIRS:
        check_symbol(symbol)


if __name__ == "__main__":
    main()
